<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<link rel="icon" type="image/png" href="assets/img/favicon.ico">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>Doctor Sign Up</title>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />

    <!-- Google Sign In -->
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="638533152381-8qvq5kf5f7u2ra7aqbe0p5hkjcmj8gfu.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>

    <!-- Bootstrap core CSS     -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Animation library for notifications   -->
    <link href="assets/css/animate.min.css" rel="stylesheet"/>

    <!--  Light Bootstrap Table core CSS    -->
    <link href="assets/css/style.css" rel="stylesheet"/>

    <!--  Light Bootstrap Table core CSS    -->
    <link href="assets/css/light-bootstrap-dashboard.css" rel="stylesheet"/>

  <!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="assets/css/pe-icon-7-stroke.css" rel="stylesheet" />

<style type="text/css">
body {
    background: #F7F7F8;
}
</style>

</head>
<body>

<div class="wrapper">
    <div class="container">
        <div class="row">                   
            <div class="col-sm-offset-2 col-sm-8">

                <form method="#" action="#">
                    <div class="card login-card">

                        <div class="header text-center">
                            <p class="login-title">Sign Up</p>
                        </div>
                        <div class="content">
                            <h4 class="title">Search</h4>
                            <div class="row">
                              <div class="col-md-6 form-group">
                                <label for="doctor-name">Name</label>
                                <input class="form-control" id="doctor-name" type="text">
                              </div>
                              <div class="col-md-6 form-group">
                                <label>State</label>
                                <select id = "states" class="form-control" name="state">
                                    <option value="" disabled selected>Please Choose...</option>
                                </select>
                              </div>
                            </div>
                            <div class="row">
                              <div class="col-md-12">
                                <button id = "search-for-doctor" type="button" class="btn-login-ghost btn-small">Search</button>
                              </div>
                            </div>
                            <div class="row">
                              <div class="col-md-12 form-group">
                                <div style = "overflow: auto; max-height: 200px; padding:20px;" id="doc-display">
                                </div>
                              </div>
                            </div>

                            <a id = "create-doctor" class="btn-login text-center pull-right next-btn" href="#">Sign Up</a>
                            <div class="clearfix"></div>      
                             
                        </div> <!-- Content Closed -->
                        <hr>
                        <div class="footer">
                             <a href="signup.html">
                                <div class="go-back-btn"><i class="fa fa-caret-left" aria-hidden="true"></i>
                                Go Back</div>
                            </a>
                        </div>

                    </div><!-- Card Closed -->
                </form>
            </div>                    
        </div>
    </div>
</div>
<div style="visibility:hidden" class="g-signin2" data-onsuccess="onSignIn" data-theme="dark"></div>
<div class="sign-out content">
    <a onclick="signOut();" class="btn-block text-center btn-login-ghost" href="signup.html"><img class="google-icon" src="assets/img/google.png">Sign Out</a>
</div>
</body>
    <!--   Core JS Files   -->
    <script src="assets/js/jquery-1.10.2.js" type="text/javascript"></script>
	<script src="assets/js/bootstrap.min.js" type="text/javascript"></script>

	<!--  Checkbox, Radio & Switch Plugins -->
	<script src="assets/js/bootstrap-checkbox-radio-switch.js"></script>

	<!--  Charts Plugin -->
	<script src="assets/js/chartist.min.js"></script>

    <!--  Notifications Plugin    -->
    <script src="assets/js/bootstrap-notify.js"></script>

    <!--  Google Maps Plugin    -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>

    <!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
	<script src="assets/js/light-bootstrap-dashboard.js"></script>

	<!-- Light Bootstrap Table DEMO methods, don't include it in your project! -->
	<script src="assets/js/demo.js"></script>

    <script src="assets/js/googleauth.js"></script>
    
    <script>
        var profileSelected = false;
        var states = ['Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado', 'Connecticut', 'District of Columbia', 'Delaware', 'Florida', 'Georgia', 'Guam', 'Hawaii', 'Idaho', 'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana', 'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota', 'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire', 'New Jersey', 'New Mexico', 'New York', 'North Carolina', 'North Dakota', 'Ohio', 'Oklahoma', 'Oregon', 'Pennsylvania', 'Puerto Rico', 'Rhode Island', 'South Carolina', 'South Dakota', 'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia', 'Virgin Islands', 'Washington', 'West Virginia', 'Wisconsin', 'Wyoming'];
        var abb = ['AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DC', 'DE', 'FL', 'GA', 'GU', 'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD', 'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ', 'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'PR', 'RI', 'SC', 'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'VI', 'WA', 'WV', 'WI', 'WY']
        for (var i=0; i<states.length; i++) {
          var state = $("<option>");
          state.text(abb[i] + ": " + states[i]);
          state.val(abb[i]);
          $("#states").append(state);
        }

        function onSignIn(googleUser) {
          var googleprofile = googleUser.getBasicProfile();
          var myUserEntity = {};
          myUserEntity.Id = googleprofile.getId();
          myUserEntity.Name = googleprofile.getName();
          sessionStorage.setItem('myUserEntity',JSON.stringify(myUserEntity));
          $.get("/profile/googleid/" + googleprofile.getId(), function(data) {
            console.log(data);
            if (data) {
              $.get("/doctor/user/" + data.id, function(docData) {
                console.log(docData);
                if(!docData) {

                  $("#doctor-name").val(googleprofile.getName());
                  $(document).on("click", "#search-for-doctor", function() {
                    var name = $("#doctor-name").val() || "";
                    var state = $("#states").val() || "";
                    var queryURL = "https://api.betterdoctor.com/2016-03-01/doctors?name=" + name + "&location=" + state + "&skip=0&limit=10&user_key=d9aae6ac51be978b847e7ed2a8ee5b21";
                    $.ajax({
                      method:"GET",
                      url:queryURL
                    }).done (function(response) {
                      $("#doc-display").empty();
                      for(var i=0; i<response.data.length; i++) {
                        var doc = $("<div>");
                        doc.attr("class", "col-md-12 selected-doc")
                        var firstName = response.data[i].profile.first_name;
                        var lastName = response.data[i].profile.last_name;
                        var pic = $("<img>");
                        pic.attr("src", response.data[i].profile.image_url);
                        pic.attr("class", "docpic")
                        doc.attr("value", i)
                        doc.append(pic);
                        doc.append(firstName + " " + lastName)
                        $("#doc-display").append(doc);
                        profileSelected = false;
                      }
                      $(document).on("click", ".selected-doc", function () {
                        $("#doc-display").empty();
                        var val = parseInt($(this).attr("value"));
                        $("#doc-display").append("<p><strong>" + response.data[val].profile.first_name + " " + response.data[val].profile.last_name + "</strong> - " + response.data[val].practices[0].visit_address.city + "</p>");
                        $("#doc-display").append("<p>" + response.data[val].specialties[0].name + "</p>")
                        $("#doc-display").append("<p>" + response.data[val].profile.bio + "</p>")
                        var insurances = $("<ul>");
                        for (var i=0; i<response.data[val].insurances.length; i++) {
                          var ins = "<li>" + response.data[val].insurances[i].insurance_plan.name + "</li>"
                          insurances.append(ins);
                        }
                        $("#doc-display").append("Insurances Accepted: ")
                        $("#doc-display").append(insurances);
                        profileSelected = true;

                        $("#create-doctor").on("click", function() {
                          if(profileSelected) {
                            var doctor = {
                              specialization: response.data[val].specialties[0].name,
                              betterdoctorId: response.data[val].uid,
                              UserId: data.id
                            }
                            $.post("/doctor", doctor)
                            .then(window.location.href = "/dashboard-doctor")
                          }
                        })
                      });
                    });
                  })
                } else {
                  window.location.href = "/dashboard-doctor"
                }
              })
            } else {
              window.location.href = "/login"
            }
          })
        }
    </script>

</html>
